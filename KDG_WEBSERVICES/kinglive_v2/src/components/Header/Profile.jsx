import { useMemo, useState } from "react"
import { useDispatch, useSelector } from "react-redux"
import { useHistory } from "react-router-dom"
import logo from '../../assets/images/header/logo.svg'
import kdg from '../../assets/images/header/kdg.png'
import { EXPLORER_URL } from '../../constant'
import { actChangeAddress, actChangeUser } from '../../store/actions'
import storage from '../../helpers/storage'

export default function Profile({ balance }) {
    const history = useHistory()
    const dispatch = useDispatch()
    
    const [IsOpenProfile, setIsOpenProfile] = useState(false)
    const userRedux = useSelector((state) => state.user)
    const userName = useMemo(
        () => (userRedux ? `${userRedux?.kyc?.first_name} ${userRedux?.kyc?.last_name}` : 'Username'),
        [userRedux]
    )
    const followers = useMemo(
        () => (userRedux ? userRedux?.kinglive?.total_follower : '0'),
        [userRedux]
    )

    const handleLogout = async () => {
        dispatch(actChangeAddress(null))
        dispatch(actChangeUser(null))
        window.web3 = null
        storage.clearToken()
        storage.clearRefresh()
    }
    return (
        <>
            <div onClick={() => setIsOpenProfile(!IsOpenProfile)} className='profile'>
                <span className='avatar'>
                    <img src={logo} alt='' />
                </span>
                <span className='name'>{userName}</span>
                <svg
                    width='10'
                    height='6'
                    viewBox='0 0 10 6'
                    fill='none'
                    xmlns='http://www.w3.org/2000/svg'
                >
                    <path
                        d='M8.5631 0.139134L4.68514 4.01803L0.807178 0.138667C0.622289 -0.0462223 0.323206 -0.0462223 0.138317 0.138667C-0.0461055 0.323556 -0.0461055 0.623106 0.138317 0.807995L4.3505 5.02157C4.53492 5.20646 4.83447 5.20646 5.01889 5.02157L9.23107 0.808034C9.41549 0.623145 9.41549 0.323128 9.23107 0.138239C9.04711 -0.0457553 8.74752 -0.0457553 8.5631 0.139134Z'
                        fill='#C4C4C4'
                    />
                </svg>
                <div className={`dropdown ${IsOpenProfile ? 'show' : ''}`}>
                    <div className='top'>
                        <div className='avatar-name'>
                            <span className='avatar'>
                                <img src={logo} alt='' />
                            </span>
                            <div className='name'>
                                <span>{userName}</span>
                                <span>{followers} Followers</span>
                            </div>
                        </div>
                        <div className='assets'>
                            <span>{balance}</span>
                            <img src={kdg} alt='' />
                        </div>
                    </div>

                    <div className='mid'>
                        <div className='item' onClick={() => history.push('/profile')}>
                            <svg
                                width='14'
                                height='15'
                                viewBox='0 0 14 15'
                                fill='none'
                                xmlns='http://www.w3.org/2000/svg'
                            >
                                <path
                                    fillRule='evenodd'
                                    clipRule='evenodd'
                                    d='M0 12.8572C0 10.8284 1.64469 9.18369 3.67352 9.18369H9.79604C11.8249 9.18369 13.4696 10.8284 13.4696 12.8572V14.3878C13.4696 14.726 13.1954 15.0001 12.8573 15.0001C12.5192 15.0001 12.2451 14.726 12.2451 14.3878V12.8572C12.2451 11.5046 11.1486 10.4082 9.79604 10.4082H3.67352C2.32096 10.4082 1.22451 11.5046 1.22451 12.8572V14.3878C1.22451 14.726 0.95039 15.0001 0.612253 15.0001C0.274115 15.0001 0 14.726 0 14.3878V12.8572Z'
                                    fill='#C4C4C4'
                                />
                                <path
                                    fillRule='evenodd'
                                    clipRule='evenodd'
                                    d='M6.73504 1.22451C5.38249 1.22451 4.28603 2.32096 4.28603 3.67352C4.28603 5.02607 5.38249 6.12253 6.73504 6.12253C8.08759 6.12253 9.18405 5.02607 9.18405 3.67352C9.18405 2.32096 8.08759 1.22451 6.73504 1.22451ZM3.06152 3.67352C3.06152 1.64469 4.70621 0 6.73504 0C8.76386 0 10.4086 1.64469 10.4086 3.67352C10.4086 5.70234 8.76386 7.34703 6.73504 7.34703C4.70621 7.34703 3.06152 5.70234 3.06152 3.67352Z'
                                    fill='#C4C4C4'
                                />
                            </svg>
                            <span>Profile</span>
                        </div>
                        <div
                            className='item'
                            onClick={() =>
                                window.open(
                                    EXPLORER_URL + '/address/' + window.ethereum.selectedAddress,
                                    '_blank'
                                )
                            }
                        >
                            <svg
                                width='14'
                                height='15'
                                viewBox='0 0 11 8'
                                fill='none'
                                xmlns='http://www.w3.org/2000/svg'
                            >
                                <path
                                    d='M10.0936 0.280837C10.0973 0.207957 10.0717 0.133849 10.016 0.0781943C9.96038 0.0225396 9.88627 -0.00312457 9.81339 0.000640937C9.80909 0.000453997 9.80484 0 9.80046 0H8.18477C8.03727 0 7.91771 0.119561 7.91771 0.267057C7.91771 0.414553 8.03727 0.534114 8.18477 0.534114H9.18241L6.54237 3.17419L5.54678 2.1786C5.49671 2.12852 5.42877 2.10038 5.35794 2.10038C5.28712 2.10038 5.21918 2.12852 5.16911 2.1786L0.368253 6.97948C0.263968 7.08377 0.263968 7.25287 0.368253 7.35718C0.42041 7.40928 0.488749 7.43535 0.557089 7.43535C0.625429 7.43535 0.693796 7.40928 0.745925 7.35713L5.35794 2.74508L6.35353 3.74067C6.45782 3.84495 6.62692 3.84495 6.73123 3.74067L9.56011 0.911813V1.81473C9.56011 1.96223 9.67967 2.08179 9.82717 2.08179C9.97467 2.08179 10.0942 1.96223 10.0942 1.81473V0.293763C10.0942 0.28941 10.0938 0.285163 10.0936 0.280837Z'
                                    fill='#C4C4C4'
                                />
                            </svg>
                            <span>Explorer</span>
                        </div>
                        <div className='item' onClick={() => history.push('/my-artwork')}>
                            <svg
                                width='15'
                                height='15'
                                viewBox='0 0 15 15'
                                fill='none'
                                xmlns='http://www.w3.org/2000/svg'
                            >
                                <path
                                    d='M7.5 0C6.01664 0 4.56659 0.439867 3.33323 1.26398C2.09986 2.08809 1.13856 3.25943 0.570907 4.62987C0.00324961 6.00032 -0.145275 7.50832 0.144114 8.96317C0.433503 10.418 1.14781 11.7544 2.1967 12.8033C3.2456 13.8522 4.58197 14.5665 6.03682 14.8559C7.49168 15.1453 8.99968 14.9967 10.3701 14.4291C11.7406 13.8614 12.9119 12.9001 13.736 11.6668C14.5601 10.4334 15 8.98336 15 7.5C14.9977 5.51157 14.2068 3.60523 12.8008 2.1992C11.3948 0.793167 9.48843 0.00226418 7.5 0V0ZM12.6525 12.3621L11.7 11.4096C12.6428 10.4007 13.1887 9.08473 13.237 7.70472H14.5847C14.5357 9.44206 13.8477 11.1003 12.6525 12.3621ZM1.76262 7.30793C1.74016 7.29934 1.71635 7.29481 1.69231 7.29457H0.476019C0.455299 7.29487 0.434747 7.29835 0.415081 7.30488C0.461513 5.56377 1.14973 3.90123 2.3475 2.63672L3.3 3.58922C2.35401 4.60164 1.80771 5.92306 1.76262 7.30793ZM11.41 3.30012C10.4011 2.35715 9.08515 1.81107 7.70508 1.76273V0.414961C9.44241 0.463996 11.1006 1.15194 12.3625 2.34715L11.41 3.30012ZM7.29492 1.76273C5.91491 1.81095 4.59895 2.35685 3.59004 3.29965L2.63754 2.34715C3.89934 1.1519 5.55759 0.463952 7.29492 0.414961V1.76273ZM7.5 2.16797C8.55458 2.16797 9.58547 2.48069 10.4623 3.06658C11.3392 3.65247 12.0226 4.48522 12.4262 5.45952C12.8297 6.43382 12.9353 7.50591 12.7296 8.54023C12.5238 9.57454 12.016 10.5246 11.2703 11.2703C10.5246 12.016 9.57454 12.5238 8.54023 12.7296C7.50592 12.9353 6.43382 12.8297 5.45952 12.4262C4.48522 12.0226 3.65247 11.3392 3.06658 10.4623C2.48069 9.58547 2.16797 8.55457 2.16797 7.5C2.16955 6.08634 2.73183 4.73104 3.73143 3.73143C4.73104 2.73182 6.08635 2.16955 7.5 2.16797ZM3.56156 11.7281C3.57108 11.7185 3.57964 11.7081 3.58711 11.6968C4.5964 12.6413 5.91353 13.1883 7.29492 13.2367V14.5843C5.55678 14.5354 3.8978 13.8469 2.63578 12.6507C2.64243 12.6459 2.64877 12.6407 2.65477 12.6352L3.56156 11.7281ZM7.70508 13.2367C9.08511 13.1884 10.4011 12.6425 11.41 11.6996L12.3625 12.6521C11.1006 13.8474 9.44241 14.5353 7.70508 14.5843V13.2367ZM14.5847 7.29457H13.237C13.1887 5.91456 12.6428 4.59862 11.7 3.58969L12.6525 2.63719C13.8477 3.89901 14.5357 5.55724 14.5847 7.29457ZM0.415081 7.69441C0.434747 7.70095 0.455299 7.70442 0.476019 7.70472H1.69184C1.71588 7.70448 1.73969 7.69996 1.76215 7.69137C1.80748 9.07754 2.35502 10.4 3.30281 11.4125C3.29158 11.42 3.2811 11.4286 3.27153 11.4381L2.36485 12.3449C2.35923 12.3509 2.35403 12.3573 2.34926 12.364C1.15054 11.0994 0.461657 9.43625 0.415081 7.69441Z'
                                    fill='#C4C4C4'
                                />
                            </svg>
                            <span>My NFT Artwork</span>
                        </div>
                    </div>

                    <div className='bot'>
                        <div className='item' onClick={() => handleLogout()}>
                            <svg
                                width='15'
                                height='15'
                                viewBox='0 0 15 15'
                                fill='none'
                                xmlns='http://www.w3.org/2000/svg'
                            >
                                <path
                                    d='M14.5311 7.03073H8.59374C8.33499 7.03073 8.125 6.82074 8.125 6.562C8.125 6.30325 8.33499 6.09326 8.59374 6.09326H14.5311C14.7898 6.09326 14.9998 6.30325 14.9998 6.562C14.9998 6.82074 14.7898 7.03073 14.5311 7.03073Z'
                                    fill='#C4C4C4'
                                />
                                <path
                                    d='M12.1874 9.37447C12.0673 9.37447 11.9474 9.32881 11.8561 9.23703C11.673 9.05382 11.673 8.75697 11.8561 8.57387L13.8686 6.56149L11.8561 4.549C11.673 4.3659 11.673 4.06905 11.8561 3.88595C12.0393 3.70273 12.3361 3.70273 12.5192 3.88595L14.8629 6.22962C15.046 6.41272 15.046 6.70957 14.8629 6.89267L12.5192 9.23635C12.4273 9.32881 12.3074 9.37447 12.1874 9.37447Z'
                                    fill='#C4C4C4'
                                />
                                <path
                                    d='M4.99988 15C4.8661 15 4.73919 14.9813 4.6124 14.9419L0.851185 13.6888C0.339421 13.51 0 13.0332 0 12.5001V1.25049C0 0.561117 0.560629 0.000488281 1.25 0.000488281C1.38366 0.000488281 1.51057 0.019256 1.63748 0.0586225L5.39858 1.31171C5.91046 1.49046 6.24977 1.96732 6.24977 2.50037V13.75C6.24977 14.4394 5.68925 15 4.99988 15ZM1.25 0.937959C1.07811 0.937959 0.937471 1.0786 0.937471 1.25049V12.5001C0.937471 12.6332 1.02685 12.7569 1.15433 12.8013L4.89792 14.0488C4.92481 14.0575 4.95983 14.0625 4.99988 14.0625C5.17177 14.0625 5.3123 13.9219 5.3123 13.75V2.50037C5.3123 2.36728 5.22292 2.24357 5.09544 2.19917L1.35185 0.951691C1.32496 0.942994 1.28994 0.937959 1.25 0.937959Z'
                                    fill='#C4C4C4'
                                />
                                <path
                                    d='M9.5309 4.99988C9.27216 4.99988 9.06216 4.78989 9.06216 4.53115V1.71873C9.06216 1.28811 8.71164 0.937471 8.28101 0.937471H1.24999C0.991242 0.937471 0.78125 0.727478 0.78125 0.468735C0.78125 0.209993 0.991242 0 1.24999 0H8.28101C9.22913 0 9.99963 0.770621 9.99963 1.71873V4.53115C9.99963 4.78989 9.78964 4.99988 9.5309 4.99988Z'
                                    fill='#C4C4C4'
                                />
                                <path
                                    d='M8.28123 13.1244H5.78124C5.52249 13.1244 5.3125 12.9144 5.3125 12.6557C5.3125 12.3969 5.52249 12.1869 5.78124 12.1869H8.28123C8.71186 12.1869 9.06238 11.8363 9.06238 11.4057V8.59325C9.06238 8.3345 9.27238 8.12451 9.53112 8.12451C9.78986 8.12451 9.99985 8.3345 9.99985 8.59325V11.4057C9.99985 12.3538 9.22935 13.1244 8.28123 13.1244Z'
                                    fill='#C4C4C4'
                                />
                            </svg>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </>
    )
}